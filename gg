#!/usr/bin/env node
const prog = require('caporal');
const ora = require('ora');
const exec = require('child_process').exec;
const { getInstalledPath } = require('get-installed-path');

//commands
const projectInit  = require('./command/project-init');
const projectBuild = require('./command/project-build');

prog
  .version('1.0.0')
  .command('init',   'Crie um novo projeto')
  .argument('[artifactId]', 'Nome do artefato', /^[a-zA-Z0-9]+$/g)
  .argument('[groupId]', 'Nome do grupo')
  .argument('[version]', 'Versão do projeto')
  .action((args, options, logger) => projectInit.run(args, options, logger))
  .command('build',   'Faz a compilação dos módulos')
  .action((args, options, logger) => projectBuild.run(args, options, logger))

getInstalledPath('@angular/cli').then(function(pt){
  prog.parse(process.argv);
}, () => {
  //pede para o usuário instalar o angular cli.
  const spinner = ora('Aguarde...').start();
  spinner.fail(`Não encontramos algumas dependências, execute: npm install -g @angular/cli`);
});
